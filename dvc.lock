schema: '2.0'
stages:
  download_data:
    cmd: python src/pipeline/download_data.py
    deps:
    - path: src/pipeline/download_data.py
      md5: a253f2456a52024015034e909fcddbb0
      size: 809
    outs:
    - path: data/raw/annotations.csv
      md5: e16179b0438f32222098fa82261cc1e7
      size: 15787
    - path: data/raw/images
      md5: a9a25050ebbf88b8188d804e54c27600.dir
      size: 12808659
      nfiles: 433
    - path: data/raw/plates.csv
      md5: 230a14f00bece9df11719b3e04ac8210
      size: 7380
  make_dataset:
    cmd: python src/pipeline/make_dataset.py
    deps:
    - path: data/raw/annotations.csv
      md5: e16179b0438f32222098fa82261cc1e7
      size: 15787
    - path: data/raw/images
      md5: a9a25050ebbf88b8188d804e54c27600.dir
      size: 12808659
      nfiles: 433
    - path: data/raw/plates.csv
      md5: 230a14f00bece9df11719b3e04ac8210
      size: 7380
    - path: src/pipeline/make_dataset.py
      md5: e1101cf189d047149df3e0bd1970088f
      size: 3052
    params:
      params.yaml:
        random_state: 42
    outs:
    - path: data/processed/test
      md5: 22a16789f61f67221776c4805359f398.dir
      size: 2584110
      nfiles: 88
    - path: data/processed/train
      md5: 052c35f5225bdc40392f1e782789e01b.dir
      size: 9000032
      nfiles: 305
    - path: data/processed/validation
      md5: 95a74dab37061a91ea7f893d4bfae23b.dir
      size: 1238510
      nfiles: 43
  train_model:
    cmd: python src/pipeline/train_model.py
    deps:
    - path: data/processed
      md5: 8c045e5acc5c24df4069d918b1f6489f.dir
      size: 12822673
      nfiles: 437
    - path: reports/great_expectations/test_annotations.json
      md5: fb68c09946cbc73175ee3cc1230f50e7
      size: 741
    - path: reports/great_expectations/train_annotations.json
      md5: fb68c09946cbc73175ee3cc1230f50e7
      size: 741
    - path: reports/great_expectations/validation_annotations.json
      md5: fb68c09946cbc73175ee3cc1230f50e7
      size: 741
    - path: src/models/fetch_model.py
      md5: cf76fc8318ef933baf2d089fec9425f7
      size: 653
    - path: src/models/model_builder.py
      md5: 2295f4b2b811389f852a3619ac319ed5
      size: 1834
    - path: src/pipeline/train_model.py
      md5: 2a1be97db3858c4e846d594288e70276
      size: 2091
    params:
      params.yaml:
        random_state: 42
        train:
          fit:
            epochs: 10
          model:
            model_name: teste
            model_version: 1
            dropout: 0.4
            cnn_blocks: 6
            filters_num: 32
            filters_kernel_size: 3
    outs:
    - path: reports/train/history.json
      md5: 91dacccb1434d85088de009945f4155a
      size: 1170
  predict_model:
    cmd: python src/pipeline/test_model.py
    deps:
    - path: src/pipeline/test_model.py
      md5: a8b788e2cc9f394d8a65fca3f6e941cb
      size: 3328
    params:
      params.yaml:
        test:
          model:
            model_name: test
            model_version: 1
            tr_ocr_processor: microsoft/trocr-small-printed
            tr_ocr_model: microsoft/trocr-small-printed
  data_expectations:
    cmd: python src/pipeline/data_expectations.py
    deps:
    - path: data/processed
      md5: 8c045e5acc5c24df4069d918b1f6489f.dir
      size: 12822673
      nfiles: 437
    outs:
    - path: reports/great_expectations/test_annotations.json
      md5: fb68c09946cbc73175ee3cc1230f50e7
      size: 741
    - path: reports/great_expectations/train_annotations.json
      md5: fb68c09946cbc73175ee3cc1230f50e7
      size: 741
    - path: reports/great_expectations/validation_annotations.json
      md5: fb68c09946cbc73175ee3cc1230f50e7
      size: 741
  test_model:
    cmd: python src/pipeline/test_model.py
    deps:
    - path: reports/train/history.json
      md5: 91dacccb1434d85088de009945f4155a
      size: 1170
    - path: src/pipeline/test_model.py
      md5: 9618d369cb959b49888148f39da0be3b
      size: 3477
    params:
      params.yaml:
        test:
          model:
            model_name: test
            model_version: 1
            tr_ocr_processor: microsoft/trocr-small-printed
            tr_ocr_model: microsoft/trocr-small-printed
